{% extends "layout_admin.html" %}
{% from "macros/form.html" import input %}
{% from "macros/modal.html" import small_modal %}

{% block title %} 음원모음 연결 {% endblock %}
{% block main_section %}

<div class="content">
    <div class="container-fluid">
		<div class="col-md-8">
			<div class="card">
				<form id="upper_music_update" name="upper_music_update" method="POST" action="/products/admin_content_upper_music_update" class="form-horizontal">

					<div class="card-header card-header-icon" data-background-color="rose">
                        <i class="material-icons">{{route_kind_id | route_kind_info('icon')}}</i>
                    </div>

					<div class="card-content">
                        <h4 class="card-title">{{route_kind_id | route_kind_info('name')}} 링크연결</h4>
                        <p class="card-category">
                            음원모음 타이틀: <strong>{{title}}</strong>
						</p>
<!--						<div class="row">-->
<!--							<label class="col-sm-2 label-on-left">음원모음 제목</label>-->
<!--                        	<div class="col-sm-8">-->
<!--								<div class="form-group label-floating is-empty">-->
<!--									<label class="control-label"></label>-->
<!--									<span class="help-block">교재코드를 조회해 주세요.</span>-->
<!--								</div>-->
<!--                            </div>-->
<!--						</div>-->
						<div class="row">
                        	<div class="col-sm-10">
								<div class="table-responsive">
									<table class="table table-striped">
										<thead class="text-primary">
											<tr>
												<th class="text-center" colspan="2" width="15%">번호</th>
												<th class="text-left" width="70%">음원컨텐츠</th>
												<th class="text-center" width="15%">구분</th>
											</tr>
										</thead>
										<tbody>
										{% for res in res_list %}
											<tr id="row_{{res.ContentMusicID}}">
												<td class="text-center" width="5%" style="{{'background-color: #FFFFE0' if res.MappingYn}}">
													<div class="checkbox">
														<label>
															<input type="checkbox" name="content_music_check" value="{{res.ContentMusicID}}" {{'checked' if res.MappingYn}}>
														</label>
 													</div>
												</td>
												<td class="text-center" width="10%" style="{{'background-color: #FFFFE0' if res.MappingYn}}">{{res.ContentMusicID}}</td>
												<td class="text-left" width="70%" style="{{'background-color: #FFFFE0' if res.MappingYn}}">{{res.ContentTitle}} &nbsp;&nbsp; / &nbsp;&nbsp; {{res.Title}}</td>
												<td class="text-center" width="15%" style="{{'background-color: #FFFFE0' if res.MappingYn}}">
 													{% if res.DisplayYn %}
														<span class="btn-success">회원</span>
													{% endif %}
													{% if res.ManagerDisplayYn %}
														<span class="btn-info">교사</span>
													{% endif %}
												</td>
											</tr>
										{% else %}
											<tr>
												<td colspan="5" class="text-center">
													<h4>데이터가 존재하지 않습니다.</h4>
												</td>
											</tr>
										{% endfor %}
										</tbody>
									</table>
      				 		 	</div>
							</div>
						</div>
						<div class="row">
                        	<div class="col-sm-10">
								<span id="alert" class="material-input text-rose"></span>
                            </div>
						</div>
						{{ input('hidden', 'route_kind_id', route_kind_id, opt='required') }}
						{{ input('hidden', 'product_kind_id', product_kind_id, opt='required') }}
						{{ input('hidden', 'content_group_id', content_group_id, opt='required') }}
						{{ input('hidden', 'upper_content_music_id', upper_content_music_id, opt='required') }}
						<div class="row">
							<div class="col-sm-10">
								<div class="form-group form-button">
									<button type="button" onclick="javascript:history.back()" class="btn btn-fill btn-github">뒤로가기</button>
 	                            	<button type="submit" id="submitBtn" class="btn btn-fill btn-facebook">연결하기</button>
 	                            	<button type="button" onclick="javascript:itemDelete()" class="btn btn-fill btn-danger">연결삭제</button>
	                        	</div>
	                    	</div>
						</div>
                    </div>
				</form>
			</div>
		</div>
    </div>
</div>

<script>
	document.getElementById('submitBtn').addEventListener('click', function(event) {
        var checkboxes = document.querySelectorAll('input[name="content_music_check"]');
        var isChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
        var alertMessage = '';

        if (!isChecked) {
            alertMessage += '하나 이상의 체크박스를 선택해야 합니다.\n';
        }

        if (alertMessage) {
            event.preventDefault();
            document.getElementById('alert').innerText = alertMessage.trim();
        }
	});

	function itemDelete() {
        upper_content_music_id = document.getElementById("upper_content_music_id").value;

		swal({
			title: '삭제',
			text: "해당 음원모음의 연결정보를 모두 삭제하시겠습니까?",
			type: 'warning',
			showCancelButton: true,
			confirmButtonClass: 'btn btn-success',
			cancelButtonClass: 'btn btn-danger',
			confirmButtonText: 'Yes, delete it!',
			buttonsStyling: false
		}).then(function () {
			$.ajax({
				type: "POST",
				url: "/products/admin_content_upper_music_link_delete",
				data: { upper_content_music_id: upper_content_music_id },
				success: function (result) {
					swal({
						title: '삭제 완료!',
						text: '정상적으로 삭제하였습니다.',
						type: 'success',
						showConfirmButton: false
					}),
					setTimeout(function () {
						window.location.href="/products/admin_content_upper_music_list/{{route_kind_id}}/{{product_kind_id}}/{{content_group_id}}";
					}, 1200);
				}
			})
		}).catch(swal.noop);
	}

</script>

{% endblock %}

